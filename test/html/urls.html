<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>HTMLImports Path Tests</title>
  <script src="../../../tools/test/htmltest.js"></script>
  <script src="../../../tools/test/chai/chai.js"></script>
  <script src="../../html-imports.js"></script>
  <link rel="import" href="imports/url-import.html">
</head>
<body>
  <script>
  
  document.addEventListener('HTMLImportsLoaded', function() {
    var i = document.querySelector('[rel=import]');
    var doc = i.import;
    var template = doc.querySelector('template');
    chai.assert.ok(template, 'template found');
    HTMLImports.path.resolvePathsInHTML(template.content,
        template.ownerDocument.baseURI);
    document.body.appendChild(template.content.cloneNode(true));

    var testRoot = template.content;
    chai.assert.equal(testRoot.querySelector('img').getAttribute('src'),
        '../foo.png', 'src path adjusted');
    chai.assert.equal(testRoot.querySelector('x-script').getAttribute('src'),
        'imports/foo/bar/baz/foo.js', 'src path adjusted');
    chai.assert.equal(testRoot.querySelector('x-a').getAttribute('href'),
        '/foo.html', 'href abs path not adjusted');
    chai.assert.equal(testRoot.querySelector('x-form').getAttribute('action'),
        'actions/action.html', 'action path adjusted');
    var style = document.querySelector('style');
    chai.assert.ok(style.sheet, 'style has sheet');
    chai.assert.ok(style.textContent.match(/@import 'stuff\/sheet\.css';/));
    chai.assert.ok(style.textContent.match(/@import 'imports\/sheet1.css';/));
    chai.assert.ok(style.textContent.match(/url\('\.\.\/foo\.png'\)/));
    chai.assert.ok(style.textContent.match(/url\('http\:\/\/www\.google\.com'\)/));
    done();  
  });
  </script>
</body>
</html>
